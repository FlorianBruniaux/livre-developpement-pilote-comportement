<!doctype html>
<html lang="fr">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="author" content="Jean-François Lépine" />
    <meta name="date" content="02/03/2013"/>
    <meta name="generator" content="easybook 5.0-DEV"/>

    <title>Automatisez votre recette | Développeurs, faites-vous plaisir !</title>

    <link rel="stylesheet" href="./css/easybook.css" />

</head>

<body class="item chapter">
<div class="container">
<div class="menu">
    <div class="row">
        <h1 class="span9"><a href="./index.html">Développeurs, faites-vous plaisir !</a></h1>
        <p class="span3">
                        <a href="./chapitre-3.html"><span>&larr;</span> Précédent</a>
            
                        <a href="./chapitre-5.html">Suivant <span>&rarr;</span></a>
                    </p>
    </div>
</div>

<div class="row">
    <div class="span9">
        <h1 id="chapitre-4"><span>Chapitre 4</span> Automatisez votre recette</h1>
        <p>Vous l'avez vu, Gherkin est un moyen simple pour votre fonctionnel pour vous fournir
une expression de besoin claire et précise.</p>

<p>Que diriez-vous maintenant de traduire ce besoin en tests automatisés ? Car, oui, c'est possible !</p>

<p>Tout besoin, s'il est exprimé clairement, peut être testé. Si ce besoin est exprimé dans une
grammaire solide et complète, tout système d'information peut le tester automatiquement.</p>

<p>Je vous propose de voir comment traduire ce besoin en tests automatisés, de telle sorte
qu'une simple ligne de commande dans un terminal vous indique si ce que vous avez développé est 
conforme ou non.</p>

<p>L'ensemble des exemples que nous allons voir sont écrits en PHP. Pourquoi ? Tout simplement 
parce que la communauté PHP a très fortement et très rapidement adheré au Déve-
loppement piloté par le comportement. Les outils PHP pour le Développement piloté par
le comportement sont matures, nombreux, et surtout offrent une souplesse qui, à ce jour,
ne se retrouve pas dans d'autres langages.</p>

<p>Cependant, il existe des outils pour écrire et lancer des tests automatisés dans n'importe
quel langage :</p>

<ul>
<li>Ruby : Cucumber (http://cukes.info)</li>
<li>Java : JBehave (http://jbehave.org)</li>
<li>C# : NBehave (https://github.com/nbehave/NBehave)</li>
<li>Python : Behave (http://packages.python.org/behave/)</li>
<li>PHP : Behat (http://behat.org) , PHPSpec (http://www.phpspec.net)</li>
<li>JavaScript : Jasmine (http://pivotal.github.com/jasmine/)</li>
<li>Net : NBehave (http://nbehave.org)</li>
</ul>

<p>Il en existe bien d'autres, la liste est loin d'être exhaustive, mais ceux-ci sont particulièrement 
utilisés dans le monde du développement aujourd'hui.</p>

<h2 id="installez-et-utilisez-behat-en-php">4.1 Installez et utilisez Behat en PHP</h2>

<p>Behat est un outil développé en PHP par Konstantin Kudryashov (@everzet) et soutenu
par la société KnpLabs. Cet outil efficace est aujourd'hui mature et largement utilisé.
Behat permet d'exécuter des tests automatisés sur tous types d'applications, PHP ou non.
Il peut tester :</p>

<ul>
<li>des applications web, en pilotant un vrai navigateur ou non</li>
<li>des applications console (terminal)</li>
<li>des morceaux de code source</li>
</ul>

<p>Du moment que ce qui est testé dispose d'un point d'entrée et d'une information de sortie,
Behat va vous permettre d'automatiser votre recette métier.</p>

<p>Dans tous les cas, il vous faudra PHP installé sur la machine qui exécutera les tests.
L'installation de PHP est résumée sur cette page : http://php.net/manual/fr/install.php.</p>

<p>Windows :</p>

<div class="code bash">
<pre class="bash">Utilisez WampServer <span class="br0">&#40;</span>http:<span class="sy0">//</span>www.wampserver.com<span class="br0">&#41;</span></pre>
</div>

<p>Ubuntu, Debian :</p>

<div class="code bash">
<pre class="bash"><span class="co0"># en ligne de commande</span>
<span class="kw2">apt-get install</span> php5-common php5-cli php5-curl</pre>
</div>

<p>Mac :</p>

<div class="code bash">
<pre class="bash">Utilisez MampServer <span class="br0">&#40;</span>http:<span class="sy0">//</span>www.mamp.info<span class="br0">&#41;</span></pre>
</div>

<p>Installer Behat est simple, peut être fait de plusieurs manières : sous forme d'archive PHP
(phar) ou en utilisant un gestionnaire de dépendance.</p>

<h3 id="installation-avec-composer">4.1.1 Installation avec Composer</h3>

<p>Créez un fichier composer.json à la racine de votre projet, avec le contenu suivant :</p>

<div class="code json">
<pre class="json">{
    &quot;require&quot;: {
        &quot;behat/behat&quot;: &quot;2.4.*@stable&quot;
    },
    &quot;config&quot;: {
        &quot;bin-dir&quot;: &quot;bin/&quot;
    }
}</pre>
</div>

<p>Exécutez ensuite la commande suivante dans votre terminal, en vous plaçant àa la racine
de votre projet :</p>

<div class="code bash">
<pre class="bash">curl http:<span class="sy0">//</span>getcomposer.org<span class="sy0">/</span>installer <span class="sy0">|</span> php
php composer.phar <span class="kw2">install</span> <span class="re5">--prefer-source</span></pre>
</div>

<h3 id="-installation-sous-forme-darchive-phar">4.1.2  Installation sous forme d'archive Phar</h3>

<p>Il vous suffit de télécharger le fichier behat.phar à l'adresse suivante : http://behat.org/
downloads/behat.phar, et de le placer dans un dossier <code>bin</code> à la racine de votre projet. Vous
aurez donc l'arborescence suivante :</p>

<div class="code bash">
<pre class="bash"><span class="sy0">/</span>chemin<span class="sy0">/</span>vers<span class="sy0">/</span>mon<span class="sy0">/</span>projet
    <span class="br0">&#40;</span>...<span class="br0">&#41;</span>
    - bin<span class="sy0">/</span>
        - behat.phar</pre>
</div>

<p>Pour des raisons de maintenabilité, il est préferable d'utiliser la méthode d'installation
avec Composer, qui vous permettra de mettre à jour très facilement l'ensemble des librairies 
PHP que vous utilisez, y compris Behat.</p>

<h3 id="preparer-le-projet">4.1.3 Préparer le projet</h3>

<p>Une fois que Behat est installé, il vous suffit d'exécuter la commande suivante :</p>

<div class="code bash">
<pre class="bash">php .<span class="sy0">/</span>bin<span class="sy0">/</span>behat <span class="re5">--init</span></pre>
</div>

<p>Cela aura pour effet de créer dans votre projet tous les éléments dont Behat a besoin pour
fonctionner. Votre arboresence ressemble désormais à :</p>

<p>Vous voici désormais avec les dossiers suivants :</p>

<ul>
<li><code>features</code> : contient la listes des fonctionnalités, sous forme de fichier <code>.feature</code></li>
<li><code>features/bootstrap</code> : contient les fichiers PHP de traduction de Fonctionnalité en code source</li>
</ul>

<p>Chaque nouvelle fonctionnalité devra donc être ajoutée dans le dossier ̀ features<code>, sous forme d'un 
fichier</code>.feature<code>. Créez par exemple le fichier</code>features/calculer-mon-age.feature`, avec le 
contenu suivant :</p>

<div class="figure center" id="figure-4-1">
    <img src="images/dev-qr-exo1-step1.png" alt="Les sources de cet exercice sont disponibles sur http://goo.gl/lgWvy" />

    <p class="caption"><strong>Figure 4.1</strong> Les sources de cet exercice sont disponibles sur http://goo.gl/lgWvy</p>
</div>


<div class="code gherkin">
<pre class="gherkin"><span class="co1"># language: fr</span><span class="co3">
Fonctionnalité</span><span class="sy2">: </span>Calculer l'âge d'une personne
    <span class="kw1">En tant qu</span>'utilisateur de l'application
    <span class="kw1">Je veux</span> connaître le nombre d'années écoulées entre deux dates
    <span class="kw1">De telle sorte que</span> je puisse connaître mon age
    <span class="co3">
Scénario</span><span class="sy2">: </span>Calculer l'âge d'une personne depuis une date antérieure à aujourd'hui
    <span class="kw1">Etant donné</span> que je suis né le 06/07/<span class="nu0">1986</span>
    <span class="kw1">Et</span> que nous sommes le <span class="nu0">20</span>/09/013
    <span class="kw1">Quand</span> je calcule mon âge
    <span class="kw1">Alors</span> je suis informé que j'ai <span class="nu0">27</span> ans
    <span class="co3">
Scénario</span><span class="sy2">: </span>Calculer l'âge d'une personne depuis une date postérieure à aujourd'hui
    <span class="kw1">Etant donné</span> que je suis né le 06/07/<span class="nu0">3013</span>
    <span class="kw1">Et</span> que nous sommes le <span class="nu0">20</span>/09/<span class="nu0">2013</span>
    <span class="kw1">Quand</span> je calcule mon âge
    <span class="kw1">Alors</span> je suis informé que je ne suis pas encore né
    <span class="co3">
Scénario</span><span class="sy2">: </span>Calculer l'âge d'une personne dont c'est l'anniversaire aujourd'hui
    <span class="kw1">Etant donné</span> que je suis né le 06/07/<span class="nu0">1986</span>
    <span class="kw1">Et</span> que nous sommes le 06/07/<span class="nu0">2013</span>
    <span class="kw1">Quand</span> je calcule mon âge
    <span class="kw1">Alors</span> je suis informé que j'ai <span class="nu0">27</span> ans
    <span class="kw1">Et</span> on me souhaite un joyeux anniversaire</pre>
</div>

<p>Puis exécutez la commande suivante pour lancer Behat :</p>

<div class="code bash">
<pre class="bash">.<span class="sy0">/</span>bin<span class="sy0">/</span>behat</pre>
</div>

<div class="figure center" id="figure-4-2">
    <img src="images/dev-behat-exo-date-undefined.jpg" alt="Les étapes de la fonctionnalité ne sont pas encore traduites : elles sont jaunes" />

    <p class="caption"><strong>Figure 4.2</strong> Les étapes de la fonctionnalité ne sont pas encore traduites : elles sont jaunes</p>
</div>


<p>Comme vous pouvez le voir, le résultat de cette commande est jaune. Cela veut tout simplement dire 
que les phrases utilisées pour exprimer le besoin n'ont pas encore de signification pour Behat. Il va falloir 
les traduire.</p>

<h2 id="traduire-une-fonctionnalite-en-code-source">4.2 Traduire une Fonctionnalité en code source</h2>

<p>Par chance, Behat est suffisammet bien fait pour vous fournir une base de travail pour traduire vos fonctionnalités. Il suffit 
de copier-coller dans le fichier <code>features/bootstrap/FeatureContext.php</code> le code PHP qui a été généré par la commande :</p>

<div class="code bash">
<pre class="bash">.<span class="sy0">/</span>bin<span class="sy0">/</span>behat</pre>
</div>

<p>Pourquoi copier ce code dans ce fichier ? Tout simplement parce que les fichiers <code>features/bootstrap/*Context.php</code> vont servir 
de passerelle entre le besoin exprimé (sous forme de phrases) et votre application.</p>

<p>Il vous appartient de modifier ces fichiers pour faire la traduction du besoin fonctionnel. C'est un travail 
qui semble long, mais en réalité il n'est pas beaucoup plus long que de tester vous-même à main que la demande initiale 
est respectée, mais à surtout l'avantage de rendre ce travail de recette interne totalement automatique.</p>

<p>Traduisez maintenant la fonctionnalité en code source dans le fichier <code>features/bootstrap/FeatureContext.php</code>, en adaptant 
le code PHP fourni par Behat selon votre besoin. Par exemple :</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="co1">// (...)</span>
&nbsp;
<span class="kw2">class</span> FeatureContext <span class="kw2">extends</span> BehatContext
<span class="br0">&#123;</span>
&nbsp;
    <span class="kw2">private</span> <span class="re0">$birthDate</span><span class="sy0">;</span>
    <span class="kw2">private</span> <span class="re0">$today</span><span class="sy0">;</span>
    <span class="kw2">private</span> <span class="re0">$output</span><span class="sy0">;</span>
&nbsp;
    <span class="co4">/**
     * Initializes context.
     * Every scenario gets it's own context object.
     *
     * @param array $parameters context parameters (set them up through behat.yml)
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> __construct<span class="br0">&#40;</span><span class="kw3">array</span> <span class="re0">$parameters</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^que je suis né le (\d+)\/(\d+)\/(\d+)$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> queJeSuisNeLe<span class="br0">&#40;</span><span class="re0">$day</span><span class="sy0">,</span> <span class="re0">$month</span><span class="sy0">,</span> <span class="re0">$year</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">birthDate</span> <span class="sy0">=</span> <span class="kw2">new</span> \DateTime<span class="br0">&#40;</span><span class="kw3">sprintf</span><span class="br0">&#40;</span><span class="st_h">'%d-%d-%d'</span><span class="sy0">,</span> <span class="re0">$year</span><span class="sy0">,</span> <span class="re0">$month</span><span class="sy0">,</span> <span class="re0">$day</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^que nous sommes le (\d+)\/(\d+)\/(\d+)$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> queNousSommesLe<span class="br0">&#40;</span><span class="re0">$day</span><span class="sy0">,</span> <span class="re0">$month</span><span class="sy0">,</span> <span class="re0">$year</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">today</span> <span class="sy0">=</span> <span class="kw2">new</span> \DateTime<span class="br0">&#40;</span><span class="kw3">sprintf</span><span class="br0">&#40;</span><span class="st_h">'%d-%d-%d'</span><span class="sy0">,</span> <span class="re0">$year</span><span class="sy0">,</span> <span class="re0">$month</span><span class="sy0">,</span> <span class="re0">$day</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^je calcule mon âge$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> jeCalculeMonAge<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">output</span> <span class="sy0">=</span> <span class="kw3">shell_exec</span><span class="br0">&#40;</span><span class="kw3">sprintf</span><span class="br0">&#40;</span><span class="st_h">'php src/age.php --birthdate=%s --today=%s'</span><span class="sy0">,</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">birthDate</span><span class="sy0">-&gt;</span><span class="me1">format</span><span class="br0">&#40;</span><span class="st_h">'Y-m-d'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">today</span><span class="sy0">-&gt;</span><span class="me1">format</span><span class="br0">&#40;</span><span class="st_h">'Y-m-d'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^je suis informé que j\'ai (\d+) ans$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> jeSuisInformeQueJAiAns<span class="br0">&#40;</span><span class="re0">$age</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="kw1">if</span><span class="br0">&#40;</span><span class="sy0">!</span><span class="kw3">preg_match</span><span class="br0">&#40;</span><span class="st_h">'!'</span><span class="sy0">.</span><span class="re0">$age</span><span class="sy0">.</span><span class="st_h">' ans!'</span><span class="sy0">,</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">output</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            <span class="kw1">throw</span> <span class="kw2">new</span> Exception<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^je suis informé que je ne suis pas encore né$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> jeSuisInformeQueJeNeSuisPasEncoreNe<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="kw1">if</span><span class="br0">&#40;</span><span class="sy0">!</span><span class="kw3">preg_match</span><span class="br0">&#40;</span><span class="st_h">'!Vous n\'êtes pas encore né!'</span><span class="sy0">,</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">output</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            <span class="kw1">throw</span> <span class="kw2">new</span> Exception<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^on me souhaite un joyeux anniversaire$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> onMeSouhaiteUnJoyeuxAnniversaire<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="kw1">if</span><span class="br0">&#40;</span><span class="sy0">!</span><span class="kw3">preg_match</span><span class="br0">&#40;</span><span class="st_h">'!Joyeux anniversaire!'</span><span class="sy0">,</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">output</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            <span class="kw1">throw</span> <span class="kw2">new</span> Exception<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Notez ces différents aspects :</p>

<ul>
<li>chaque phrase est convertie en une méthode PHP</li>
<li>le lien entre les phrases et les méthodes PHP est effectué par un expression régulière (par exemple : <code>/^on me souhaite un joyeux anniversaire$/</code>)</li>
<li>vous devez traduire chaque étape. Behat comprendra qu'une étape n'est pas valide si vous levez une exception, comme c'est le cas dans la méthode <code>onMeSouhaiteUnJoyeuxAnniversaire()</code></li>
<li>il est possible de recevoir certaines informations (nombres, exemples...) sous forme de paramètres de méthodes.</li>
</ul>

<p>Maintenant, il vous suffit de relancer Behat pour vérifier automatiquement que votre application a bien 
le comportement attendu :</p>

<div class="code bash">
<pre class="bash">.<span class="sy0">/</span>bin<span class="sy0">/</span>behat</pre>
</div>

<div class="figure center" id="figure-4-3">
    <img src="images/dev-behat-exo-date-fail.jpg" alt="Les fonctionnalités échouent : elles sont rouges" />

    <p class="caption"><strong>Figure 4.3</strong> Les fonctionnalités échouent : elles sont rouges</p>
</div>


<p>Il vous suffit finalement de développer votre application PHP, conforme aux attentes fonctionnelles, puis de relancer 
Behat pour vous assurer que vous avez bien traité la demande initiale.</p>

<h2 id="exploitez-les-jeux-dexemples">4.3 Exploitez les jeux d'exemples</h2>

<div class="figure center" id="figure-4-4">
    <img src="images/dev-qr-exo1-step2.png" alt="Les sources de cet exercice sont disponibles sur http://goo.gl/jaLxP" />

    <p class="caption"><strong>Figure 4.4</strong> Les sources de cet exercice sont disponibles sur http://goo.gl/jaLxP</p>
</div>


<p>Vous l'avez vu, votre fonctionnel peut vous fournir des exemples, grâce à la syntaxe Gherkin.</p>

<p>On pourrait par exemple modifier notre fonctionnalité de la façon suivante :</p>

<div class="code gherkin">
<pre class="gherkin"><span class="co1"># language: fr</span><span class="co3">
Fonctionnalité</span><span class="sy2">: </span>Calculer l'âge d'une personne
    <span class="kw1">En tant qu</span>'utilisateur de l'application
    <span class="kw1">Je veux</span> connaître le nombre d'années écoulées entre deux dates
    <span class="kw1">De telle sorte que</span> je puisse connaître mon age
    <span class="co3">
    Plan du Scénario</span><span class="sy2">: </span>Calculer l'âge d'une personne
      <span class="kw1">Etant donné</span> que je suis né le <span class="st0">&quot;&lt;dateNaissance&gt;&quot;</span>
      <span class="kw1">Et</span> que nous sommes le <span class="st0">&quot;&lt;dateDuJour&gt;&quot;</span>
      <span class="kw1">Quand</span> je calcule mon âge
      <span class="kw1">Alors</span> on me répond <span class="st0">&quot;&lt;reponseAttendu&gt;&quot;</span>
      <span class="co4">
      Exemples</span><span class="sy2">:
</span>        | dateNaissance | dateDuJour | reponseAttendu                           <span class="sy2">|
</span><span class="co0">        | 06/07/1986    | 20/09/2013 | Vous avez 27 ans                         |
        | 06/07/1985    | 20/09/2013 | Vous avez 28 ans                         |
        | 26/11/2020    | 20/09/2013 | Vous n'êtes pas encore né                |
        | 06/07/1986    | 06/07/2013 | Vous avez 27 ans. Joyeux anniversaire    |</span></pre>
</div>

<p>Vous voici avec une fonctionnalité simple, claire et complète.</p>

<p>Travailler avec des exemples ne change strictement rien pour vous. En réalité, Behat 
va travailler avec chaque jeu d'exemple, un à un, et va vous envoyer chaque information 
sous forme de paramètre de méthode, sans que cela n'ait le moindre impact sur votre code.</p>

<p>Voici une traduction possible de cette fonctionnalité :</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="co1">// file features/bootstrap/FeatureContext.php</span>
<span class="co1">// (...)</span>
&nbsp;
<span class="kw2">class</span> FeatureContext <span class="kw2">extends</span> BehatContext
<span class="br0">&#123;</span>
&nbsp;
    <span class="kw2">private</span> <span class="re0">$birthDate</span><span class="sy0">;</span>
    <span class="kw2">private</span> <span class="re0">$today</span><span class="sy0">;</span>
    <span class="kw2">private</span> <span class="re0">$output</span><span class="sy0">;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^que je suis né le &quot;([^&quot;]*)&quot;$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> queJeSuisNeLe<span class="br0">&#40;</span><span class="re0">$date</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">birthDate</span> <span class="sy0">=</span> DateTime<span class="sy0">::</span><span class="me2">createFromFormat</span><span class="br0">&#40;</span><span class="st_h">'d/m/Y'</span><span class="sy0">,</span> <span class="re0">$date</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^que nous sommes le &quot;([^&quot;]*)&quot;$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> queNousSommesLe<span class="br0">&#40;</span><span class="re0">$date</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">today</span> <span class="sy0">=</span> DateTime<span class="sy0">::</span><span class="me2">createFromFormat</span><span class="br0">&#40;</span><span class="st_h">'d/m/Y'</span><span class="sy0">,</span> <span class="re0">$date</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^je calcule mon âge$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> jeCalculeMonAge<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">output</span> <span class="sy0">=</span> <span class="kw3">shell_exec</span><span class="br0">&#40;</span><span class="kw3">sprintf</span><span class="br0">&#40;</span><span class="st_h">'php src/age.php --birthdate=%s --today=%s'</span><span class="sy0">,</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">birthDate</span><span class="sy0">-&gt;</span><span class="me1">format</span><span class="br0">&#40;</span><span class="st_h">'Y-m-d'</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">today</span><span class="sy0">-&gt;</span><span class="me1">format</span><span class="br0">&#40;</span><span class="st_h">'Y-m-d'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^on me répond &quot;([^&quot;]*)&quot;$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> onMeRepond<span class="br0">&#40;</span><span class="re0">$response</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="kw1">if</span> <span class="br0">&#40;</span><span class="kw4">false</span> <span class="sy0">===</span> <span class="kw3">strpos</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">output</span><span class="sy0">,</span> <span class="re0">$response</span><span class="br0">&#41;</span><span class="br0">&#41;</span> <span class="br0">&#123;</span>
            <span class="kw1">throw</span> <span class="kw2">new</span> Exception<span class="sy0">;</span>
        <span class="br0">&#125;</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Votre fonctionnel peut désormais ajouter autant d'exemples qui le souhaite, votre travail de traduction ne changera plus.</p>

<blockquote>
  <p>Utiliser des exemples est très simple avec Behat.</p>
</blockquote>

<h2 id="reutilisez-vos-precedents-tests">4.4 Réutilisez vos précédents tests</h2>

<div class="figure center" id="figure-4-5">
    <img src="images/dev-qr-exo2.png" alt="Les sources de cet exercice sont disponibles sur http://goo.gl/onk8x" />

    <p class="caption"><strong>Figure 4.5</strong> Les sources de cet exercice sont disponibles sur http://goo.gl/onk8x</p>
</div>


<p>Vous l'avez vu, la phase de traduction d'une phrase (étape) en code source peut parfois être longue.</p>

<p>C'est pour cela que vous devez faire en sorte de faciliter votre travail : réutilisez au maximum vos définitions. Attention, je ne 
vous parle en aucun cas ici de découper votre code comme vous le feriez dans une application (refractoring, respect des 
principes SOLID, découpage des méthodes...).</p>

<p>Non, la réutilisabilité dans les Contextes de traduction (fichiers <code>*Context.php</code>) ne passe pas par une réutilisation du code source, 
mais bel et bien par une réutilisation de phrases. <em>En réalité, vous devez apprendre à faire du refractoring de phrases</em>.</p>

<p>Cette tâche n'est pas simple au départ, mais est en réalité assez naturelle. Chaque phrase, qui correspond à un contexte, un 
élément déclencheur ou un résultat attendu, peut être découpée en différentes étapes, qui <em>elles-mêmes pourront être décomposées 
jusqu'à arriver à des expressions atomiques simples</em>.</p>

<p>Prenez par exemple la phrase suivante :</p>

<div class="code gherkin">
<pre class="gherkin"><span class="kw1">Quand</span> j'ajoute dans mon panier <span class="st0">&quot;télévision Sony&quot;</span>  depuis le catalogue produit</pre>
</div>

<p>Cette phrase peut être découpée, par exemple :</p>

<div class="code gherkin">
<pre class="gherkin"><span class="kw1">Etant donné</span> que je consulte le catalogue produit
<span class="kw1">Quand</span> j'ajoute dans mon panier <span class="st0">&quot;télévision Sony&quot;</span></pre>
</div>

<p>Qui elles-mêmes peuvent être découpées pour créer des expressions atomiques réutilisables :</p>

<div class="code gherkin">
<pre class="gherkin"><span class="kw1">Etant donné</span> que je suis sur la page <span class="st0">&quot;/catalogue/produits&quot;</span>
<span class="kw1">Quand</span> je coche <span class="st0">&quot;télévision Sony&quot;</span>
<span class="kw1">Et</span> je clique sur <span class="st0">&quot;Ajouter au panier&quot;</span></pre>
</div>

<p>Vous pouvez constater que les trois dernières expressions sont en réalité des étapes (web) atomiques réutilisables à l'infini. 
Cela signifie qu'une fois que vous les aurez traduites, vous n'aurez plus jamais à revenir dessus, et vous pourrez vous en servir à votre gré.</p>

<p>Vous pourriez désormais écrire, par exemple :</p>

<div class="code gherkin">
<pre class="gherkin"><span class="kw1">Etant donné</span> que je suis sur la page <span class="st0">&quot;/home&quot;</span>
<span class="kw1">Etant donné</span> que je suis sur la page <span class="st0">&quot;/mon-compte&quot;</span>
<span class="sy1">...</span>
&nbsp;</pre>
</div>

<p>Cette démarche permet donc de faire du refractoring de phrases pour arriver à des expressions atomiques. Par chance, c'est 
extrêmement simple à faire avec Behat. Regardez plutôt :</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="co1">// (...)</span>
&nbsp;
<span class="kw2">use</span> Behat\Behat\Context\Step<span class="sy0">;</span>
&nbsp;
<span class="kw2">class</span> FeatureContext <span class="kw2">extends</span> BehatContext
<span class="br0">&#123;</span></pre>
</div>

<div class="code code">
<pre class="code">    /**
     * @When /^j\'ajoute dans mon panier &quot;([^&quot;]*)&quot;  depuis le catalogue produit$/
     */
    public function jAjouteDansMonPanierDepuisLeCatalogueProduit($produit)
    {
        return array(
            new Step\Given('que je consulte le catalogue produit')
            , new Step\When(sprintf('j\'ajoute dans mon panier &quot;%s&quot;', $produit))
        );
    }</pre>
</div>

<p>Comme vous le voyez, il suffit simplement, dans la méthode de définition, de retourner un tableau d'étapes. Chaque 
étape est en réalité un objet PHP (<code>Given</code>, <code>When</code> ou <code>Then</code>) qui accepte en paramètre de constructeur la phrase que l'on souhaite 
utiliser. Pratique non ?</p>

<p>Ce qui donnerait par exemple dans notre cas :</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="co1">// (...)</span>
&nbsp;
<span class="kw2">use</span> Behat\Behat\Context\Step<span class="sy0">;</span>
&nbsp;
<span class="kw2">class</span> FeatureContext <span class="kw2">extends</span> BehatContext
<span class="br0">&#123;</span>
&nbsp;
    <span class="co4">/**
     * @When /^j\'ajoute dans mon panier &quot;([^&quot;]*)&quot;  depuis le catalogue produit$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> jAjouteDansMonPanierDepuisLeCatalogueProduit<span class="br0">&#40;</span><span class="re0">$produit</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="kw1">return</span> <span class="kw3">array</span><span class="br0">&#40;</span>
            <span class="kw2">new</span> Step\Given<span class="br0">&#40;</span><span class="st_h">'que je consulte le catalogue produit'</span><span class="br0">&#41;</span>
            <span class="sy0">,</span> <span class="kw2">new</span> Step\When<span class="br0">&#40;</span><span class="kw3">sprintf</span><span class="br0">&#40;</span><span class="st_h">'j\'ajoute dans mon panier &quot;%s&quot;'</span><span class="sy0">,</span> <span class="re0">$produit</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
        <span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^que je consulte le catalogue produit$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> queJeConsulteLeCatalogueProduit<span class="br0">&#40;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="kw1">return</span> <span class="kw3">array</span><span class="br0">&#40;</span>
            <span class="kw2">new</span> Step\Given<span class="br0">&#40;</span><span class="st_h">'que je suis sur la page &quot;/catalogue/produits&quot;'</span><span class="br0">&#41;</span>
        <span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @When /^j\'ajoute dans mon panier &quot;([^&quot;]*)&quot;$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> jAjouteDansMonPanier<span class="br0">&#40;</span><span class="re0">$produit</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="kw1">return</span> <span class="kw3">array</span><span class="br0">&#40;</span>
            <span class="kw2">new</span> Step\When<span class="br0">&#40;</span><span class="kw3">sprintf</span><span class="br0">&#40;</span><span class="st_h">'je coche &quot;%s&quot;'</span><span class="sy0">,</span> <span class="re0">$produit</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
            <span class="sy0">,</span> <span class="kw2">new</span> Step\When<span class="br0">&#40;</span><span class="st_h">'je clique sur &quot;Ajouter au panier&quot;'</span><span class="br0">&#41;</span>
        <span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @Given /^que je suis sur la page &quot;([^&quot;]*)&quot;$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> queJeSuisSurLaPage<span class="br0">&#40;</span><span class="re0">$url</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="co1">// ?</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @When /^je coche &quot;([^&quot;]*)&quot;$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> jeCoche<span class="br0">&#40;</span><span class="re0">$produit</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="co1">// ?</span>
    <span class="br0">&#125;</span>
&nbsp;
    <span class="co4">/**
     * @When /^je clique sur &quot;([^&quot;]*)&quot;$/
     */</span>
    <span class="kw2">public</span> <span class="kw2">function</span> jeCliqueSur<span class="br0">&#40;</span><span class="re0">$bouton</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
        <span class="co1">// ?</span>
    <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Notez les trois dernières traduction (les méthodes ̀ queJeSuisSurLaPage()<code>,</code>jeCoche()<code>et</code>jeCliqueSur()`). Ces méthodes 
de traduction concernent le comportement d'un navigateur web, comme Firefox ou Chrome... Il arrive en effet très souvent 
qu'il faille effectuer des actions qui n'existent que dans un navigateur. Vous allez voir qu'avec Behat c'est très facile !</p>

<blockquote>
  <p>Oubliez le refractoring de code. Vous devez apprendre à faire du refractoring de phrases.</p>
</blockquote>

<h2 id="testez-une-application-web">4.5 Testez une application Web</h2>

<p>Vous savez désormais automatiser une recette fonctionnelle d'une applicatif. Cependant, dans le cadre d'une application internet, 
la recette fonctionnelle consiste le plus souvent à parcourir des pages web, vérifier leur conformité (délivrent-elles le service 
attendu ?), en soumettant un formulaire, en cliquant sur un lien... Bref, en surfant sur un site web.</p>

<p>Heureusement, il est aujourd'hui très simple d'automatiser une recette fonctionnelle, quand bien même elle concerne une 
application web. Allons-y !</p>

<p>Une fois de plus nous allons utiliser Behat. Plus précisément, nous allons utiliser un module de Behat, appelé Mink, qui permet de 
naviguer dans une application web et de lancer des tests automatisés lors decette navigation.</p>

<p>Concrètement, Mink permet une double approche :</p>

<ul>
<li>Exécuter des tests fonctionnels dans un navigateur virtuel (émulateur)</li>
<li>Exécuter des tests fonctionnels au sein d'un vrai navigateur, comme Chrome ou Firefox par exemple</li>
</ul>

<p>Il peut sembler étrange d'exécuter des tests dans un navigateur virtuel. Cependant, bien souvent le comportement fonctionnel 
que l'on souhaite tester est en réalité disponible driectement au sein des pages web, dans le HTML. <em>On préferera alors priviléger 
les tests lancés dans un vrai navigateur uniquement lorsque le test porte sur des fonctionnalités complexes (en Javascript ou en Ajax 
par exemple), ces tests étant en général beaucoup plus lourd et long à s'exécuter que les autres</em>.</p>

<p>Pour commencer, installez <code>Mink</code> :</p>

<h3 id="installer-mink-avec-composer">4.5.1 Installer Mink avec Composer</h3>

<p>Modifiez le fichier composer.json que vous avez préalablement créé, et ajoutez-y le code suivant :</p>

<div class="code json">
<pre class="json">&quot;require&quot;: {
    &quot;behat/behat&quot;: &quot;2.4.*@stable&quot;,
    &quot;behat/mink&quot;: &quot;1.4@stable&quot;,
    &quot;behat/mink-extension&quot;: &quot;*&quot;,
    &quot;behat/mink-goutte-driver&quot;: &quot;*&quot;
}</pre>
</div>

<p>Puis relancez Composer :</p>

<div class="code bash">
<pre class="bash">php composer.phar update</pre>
</div>

<h3 id="installer-mink-sous-forme-darchive-phar">4.5.2 Installer Mink sous forme d'archive Phar</h3>

<p>Exécutez la commande suivante :</p>

<div class="code bash">
<pre class="bash"><span class="kw2">wget</span> https:<span class="sy0">//</span>github.com<span class="sy0">/</span>downloads<span class="sy0">/</span>Behat<span class="sy0">/</span>Mink<span class="sy0">/</span>mink.phar</pre>
</div>

<p>Il vous suffit ensuite d'ajouter l'inscruction suivantes dans vos fichiers PHP de Contexte :</p>

<div class="code php">
<pre class="php"><span class="kw1">require_once</span> <span class="st_h">'mink.phar'</span><span class="sy0">;</span></pre>
</div>

<p>Ensuite, il suffit de configurer Behat pour lui indiquer que l'on utilise Mink. Mink étant une extension de Behat, C'est très simple. 
Il suffit de créer le fichier <code>behat.yml</code> à la racine de votre projet :</p>

<div class="code yaml">
<pre class="yaml"><span class="co4">default</span>:<span class="co4">
  extensions</span>:<span class="co4">
    Behat\MinkExtension\Extension</span>:<span class="co3">
      base_url</span><span class="sy2">: </span>http://url-de-votre-site.fr<span class="co3">
      goutte</span><span class="sy2">: </span>~</pre>
</div>

<p>Voilà, Mink est installé !</p>

<p>Rappelez-vous, le travail de Spécification fonctionelle passe par l'utilisation d'expressions, elles-mêmes organisés autour 
d'une grammaire : Gherkin. Mink a ceci d'intéressant qu'il propose nativement un panel assez large d'expressions qui concernent 
un navigateur, que vous pouvez donc réutiliser (<code>comme "Quand je vais sur "http://..."</code>, ou encore <code>Quand je remplis "Votre prénom" avec 
"Jean-François"</code>...).</p>

<p>Un besoin exprimé de la façon suivante sera donc automatiquement compris par Behat lorsque Mink est installé:</p>

<div class="code gherkin">
<pre class="gherkin"><span class="co3">Scenario</span><span class="sy2">: </span>s'identifier au sein de l'application
  <span class="kw1">Etant donné</span> que je suis sur <span class="st0">&quot;/accueil&quot;</span>
  <span class="kw1">Quand</span> je suis le lien <span class="st0">&quot;Me connecter&quot;</span>
  <span class="kw1">Et</span> que je remplis <span class="st0">&quot;Identifiant&quot;</span> avec <span class="st0">&quot;Jean-François&quot;</span>
  <span class="kw1">Et</span> que je remplis <span class="st0">&quot;Mot de passe&quot;</span> avec <span class="st0">&quot;azerty&quot;</span>
  <span class="kw1">Et</span> que je clique sur <span class="st0">&quot;Valider&quot;</span>
  <span class="kw1">Alors</span> <span class="kw1">je dois</span> voir <span class="st0">&quot;Bienvenue Jean-François&quot;</span></pre>
</div>

<p>Pratique non ? Constatez que vous n'avez même pas besoin de parler de nom (attribut <code>name</code>) des champs HTML ; non, Behat 
fera le lien pour vous entre les <code>label</code>, <code>title</code>, <code>class</code>... de vos champs de formulaire et l'expression que vous avez utilisée.</p>

<p>Au fait, avez-vous lancé Behat pour vérifier que cela fonctionne ? Allez-y ; Utiliser Mink ne change rien à l'utilisation de Behat, 
il suffit comme avant d'exécuter la commande suivante :</p>

<div class="code bash">
<pre class="bash">php .<span class="sy0">/</span>bin<span class="sy0">/</span>behat</pre>
</div>

<p>Bien entendu, il va souvent arriver que vous ayez besoin de gérer des cas plus complexes que ce qu'il est possible de faire avec
les exprpessions disponibles nativement dans Mink.</p>

<p>Dans ce cas, il va s'agir, ni plus ni moins, de piloter votre navigateur (quel qu'il soit). Un très large éventail 
de méthodes sont disponibles :</p>

<div class="code php">
<pre class="php"><span class="kw2">&lt;?php</span>
<span class="kw2">class</span> FeatureContext <span class="kw2">extends</span> MinkContext <span class="br0">&#123;</span>
&nbsp;
    <span class="co1">// (...)</span>
    <span class="re0">$browser</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getMink</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">getBrowser</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$page</span> <span class="sy0">=</span> <span class="re0">$browser</span><span class="sy0">-&gt;</span><span class="me1">getPage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$button</span> <span class="sy0">=</span> <span class="re0">$page</span><span class="sy0">-&gt;</span><span class="me1">find</span><span class="br0">&#40;</span><span class="st_h">'css'</span><span class="sy0">,</span> <span class="st_h">'.class-css-du-bouton'</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$button</span><span class="sy0">-&gt;</span><span class="me1">click</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Notez que désormais notre classe n'hérite plus de <code>BehatContext</code> mais de <code>MinkContext</code>.</p>

<p>Examinons ce code ensemble. Tout d'abord, nous récupérons la page courante affichée par le navigateur :</p>

<div class="code php">
<pre class="php">    <span class="re0">$browser</span> <span class="sy0">=</span> <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">getMink</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">getBrowser</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$page</span> <span class="sy0">=</span> <span class="re0">$browser</span><span class="sy0">-&gt;</span><span class="me1">getPage</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Ensuite, il suffit de récupérer un élément HTML dans la page, puis d'exécuter l'action souhaitée sur cet élément (ici un click, 
mais on pourrait imaginer saisir une valeur, le cocher...) :</p>

<div class="code php">
<pre class="php">    <span class="re0">$button</span> <span class="sy0">=</span> <span class="re0">$page</span><span class="sy0">-&gt;</span><span class="me1">find</span><span class="br0">&#40;</span><span class="st_h">'css'</span><span class="sy0">,</span> <span class="st_h">'.class-css-du-bouton'</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$button</span><span class="sy0">-&gt;</span><span class="me1">click</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Vous avez bien vu : la méthode <code>find()</code> permet de récupérer des éléments en utilisant des sélecteurs CSS. Ce sont les mêmes 
que ce que vous utilisez dans vos feuilles de style CSS. Attention, les pseudo-styles (':hover', etc) ne sont pas supportés. 
Bien entendu, il est également possible de récupérer des éléments HTML en utilisant des expressions xPath. La 
<a href="http://mink.behat.org/#xpath-selectors">documentation de Mink est assez complète</a> sur ce sujet.</p>

<p>Il ne vous reste plus qu'à traduire les expressions fonctionnelles de vos clients en différentes actions au sein 
d'un navigateur, et vous saurez traiter alors la majorité des cas.</p>

<p>Sachez également que Mink permet très facilement de piloter un vrai navigateur. C'est utile lorsque l'on souhaite, par exemple, tester 
des fonctionnalités qui nécessite un environnement Ajax ou JavaScript. Dans ce cas, juste au dessus des 
Scénarios ou des Fonctionnalités concernées, il suffit d'ajouter le tag <code>@javascript</code>. Ce tag indiquera à Behat que vous souhaitez, dans ces 
cas spécifiques, lancer un vrai navigateur pour les tests. Bien entendu, dans ce cas, la machine qui exécute les tests doit posséder un 
environnement graphique (comme c'est le cas pour les ordinateurs de Bureau).</p>

<p>Lorsque l'on souhaite piloter un vrai navigateur, Behat délègue en réalité le travail à des outils spécialisés, comme <code>Sahi</code>, ou encore 
comme <code>Selenium</code>. Dans ce cas, ces outils doivent être installés sur votre machine. La procédure pour les installer est en 
général très simple, et est bien expliquée dans la <a href="http://mink.behat.org/#different-browsers-drivers">documentation officielle</a>.</p>

<p>Voici la configuration à ajouter dans le fichier <code>behat.yml</code> pour indiquer que vous souhaitez utiliser Chrome par exemple, grâce au driver Sahi :</p>

<div class="code yaml">
<pre class="yaml"><span class="co4">default</span>:<span class="co4">
    extensions</span>:<span class="co4">
        Behat\MinkExtension\Extension</span>:<span class="co3">
            base_url</span><span class="sy2">: </span>http://url-de-votre-site.fr/<span class="co3">
            goutte</span><span class="sy2">: </span>~<span class="co3">
            default_session</span><span class="sy2">: </span>sahi<span class="co3">
            javascript_session</span><span class="sy2">: </span>sahi<span class="co3">
            browser_name</span><span class="sy2">: </span>chrome<span class="co4">
            sahi</span>:<span class="co3">
              host</span><span class="sy2">: </span>localhost<span class="co3">
              port</span><span class="sy2">: </span><span class="nu0">9999</span></pre>
</div>

<p>Voici celle que vous pourriez utiliser pour piloter Firefox :</p>

<div class="code yaml">
<pre class="yaml"><span class="co4">default</span>:<span class="co4">
    extensions</span>:<span class="co4">
        Behat\MinkExtension\Extension</span>:<span class="co3">
            base_url</span><span class="sy2">: </span>http://url-de-votre-site.fr/<span class="co3">
            goutte</span><span class="sy2">: </span>~<span class="co3">
            default_session</span><span class="sy2">: </span>sahi<span class="co3">
            javascript_session</span><span class="sy2">: </span>sahi<span class="co3">
            browser_name</span><span class="sy2">: </span>firefox<span class="co4">
            sahi</span>:<span class="co3">
              host</span><span class="sy2">: </span>localhost<span class="co3">
              port</span><span class="sy2">: </span><span class="nu0">9999</span></pre>
</div>

<p>Vous avez désormais toutes les connaissances requises pour commencer à tester automatiquement un projet web. Pourquoi ne pas vous 
entraîner par exemple sur une petite application web de guichet bancaire ?</p>

<div class="figure center" id="figure-4-6">
    <img src="images/dev-qr-exo3.png" alt="La correction de cet exercice est disponible sur http://goo.gl/LISNg" />

    <p class="caption"><strong>Figure 4.6</strong> La correction de cet exercice est disponible sur http://goo.gl/LISNg</p>
</div>


<p>Je vous propose de vous entraîner en traduisant le besoin 
suivant en tests, dans un Contexte de définition :</p>

<div class="code gherkin">
<pre class="gherkin"><span class="co1">#language: fr</span><span class="co3">
Fonctionnalité</span><span class="sy2">: </span>Gérer un compte bancaire
  <span class="kw1">Afin de</span> gérer mon compte bancaire
  <span class="kw1">En tant qu</span>'utilisateur connecté
  Je peux ajouter ou retirer de l'argent sur mon compte
  <span class="co4">
  Contexte</span><span class="sy2">:
</span>    <span class="kw1">Etant donné</span> que je suis connecté <span class="kw1">en tant que</span> <span class="st0">&quot;jean-françois&quot;</span>
    <span class="kw1">Et</span> que j'ai <span class="st0">&quot;50&quot;</span> euro
    <span class="kw1">Et</span> je suis sur <span class="st0">&quot;/&quot;</span>
    <span class="co3">
  Scénario</span><span class="sy2">: </span>Consulter mes comptes
    <span class="kw1">Alors</span> je devrais voir <span class="st0">&quot;Vous avez 50 euro sur votre compte&quot;</span>
    <span class="co3">
  Plan du Scénario</span><span class="sy2">: </span>Ajouter de l'argent
    <span class="kw1">Etant donné</span> que j'ai <span class="st0">&quot;&lt;montantInitial&gt;&quot;</span> euro
    <span class="kw1">Quand</span> je sélectionne <span class="st0">&quot;&lt;operation&gt;&quot;</span> depuis <span class="st0">&quot;Operation&quot;</span>
    <span class="kw1">Et</span> je remplis <span class="st0">&quot;Montant&quot;</span> avec <span class="st0">&quot;&lt;montant&gt;&quot;</span>
    <span class="kw1">Et</span> je presse <span class="st0">&quot;Go&quot;</span>
    <span class="kw1">Alors</span> je devrais voir <span class="st0">&quot;Vous avez &lt;montantFinal&gt; euro sur votre compte&quot;</span>
    <span class="co4">
    Exemples</span><span class="sy2">:
</span>     | operation     | montantInitial| montant   | montantFinal  <span class="sy2">|
</span><span class="co0">     | Ajouter       | 50            | 10        | 60            |
     | Ajouter       | 50            | 20        | 70            |
     | Ajouter       | 50            | 5         | 55            |
     | Ajouter       | 50            | 0         | 50            |
     | Retirer       | 50            | 10        | 40            |
     | Retirer       | 50            | 20        | 30            |
     | Retirer       | 50            | 30        | 20            |
     </span><span class="co3">
  Scénario</span><span class="sy2">: </span>Les découverts sont interdits
    <span class="kw1">Etant donné</span> que j'ai <span class="st0">&quot;50&quot;</span> euro
    <span class="kw1">Quand</span> je sélectionne <span class="st0">&quot;Retirer&quot;</span> depuis <span class="st0">&quot;Operation&quot;</span>
    <span class="kw1">Et</span> je remplis <span class="st0">&quot;Montant&quot;</span> avec <span class="st0">&quot;60&quot;</span>
    <span class="kw1">Et</span> je presse <span class="st0">&quot;Go&quot;</span>
    <span class="kw1">Alors</span> je devrais voir <span class="st0">&quot;Vous avez 50 euro sur votre compte&quot;</span>
    <span class="kw1">Et</span> je devrais voir <span class="st0">&quot;Les decouverts ne sont pas autorises&quot;</span></pre>
</div>

<p>A vous de jouer !</p>

<blockquote>
  <p>Mink permet facilement de piloter un navigateur pour tester vos applications web.</p>
</blockquote>

<h2 id="-teser-un-site-web-exercice-complet"> Teser un site web : exercice complet</h2>

    </div>

    <div class="span3">
        <div class="item local_toc">
            <h3>Table des matières</h3>

            <ul class="unstyled">
                                                <li class="level-1">
                        <span></span>
                        <a href="#chapitre-4">Automatisez votre recette</a>
                    </li>
                                    <li class="level-2">
                        <span>4.1</span>
                        <a href="#installez-et-utilisez-behat-en-php">Installez et utilisez Behat en PHP</a>
                    </li>
                                    <li class="level-2">
                        <span>4.2</span>
                        <a href="#traduire-une-fonctionnalite-en-code-source">Traduire une Fonctionnalité en code source</a>
                    </li>
                                    <li class="level-2">
                        <span>4.3</span>
                        <a href="#exploitez-les-jeux-dexemples">Exploitez les jeux d'exemples</a>
                    </li>
                                    <li class="level-2">
                        <span>4.4</span>
                        <a href="#reutilisez-vos-precedents-tests">Réutilisez vos précédents tests</a>
                    </li>
                                    <li class="level-2">
                        <span>4.5</span>
                        <a href="#testez-une-application-web">Testez une application Web</a>
                    </li>
                                    <li class="level-2">
                        <span>4.6</span>
                        <a href="#-teser-un-site-web-exercice-complet"> Teser un site web : exercice complet</a>
                    </li>
                                        </ul>
        </div>
    </div>
</div>
</div>
</body>
</html>